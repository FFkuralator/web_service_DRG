import sqlite3
from contextlib import closing
from backend.database.db import Database


def init_sample_data():
    db = Database('instance/app.db')

    with closing(db._get_connection()) as conn:
        conn.executescript("""
            DELETE FROM space_features;
            DELETE FROM user_favorites;
            DELETE FROM space_images;
            DELETE FROM spaces;
            DELETE FROM categories;
        """)
        conn.commit()

    categories = [
        (1, "Танцы"),
        (2, "Мероприятия")
    ]

    spaces = [
        (1, "InSpo | Танцевальная база ДВФУ", "11", "8", "у лифта",
         "Для прохода в корпус необходимо:<br>- Прийти за 5 минут до начала своего времени.<br>- В случае, если Вы не проживаете в корпусе, оставить пропуск и записаться в журнале посещений на посту охраны (цель посещения – спортивный зал).<br><br>Для прохода в зал необходимо:<br>- Перед занятием обратиться к Администратору для получения ключей от зала, отметиться в журнале выдачи ключей о получении и забрать ключи.<br>- После окончания своего времени необходимо повторно отметиться в журнале выдачи ключей о сдаче и сдать ключ Администратору.<br><br>Обязательно приносить с собой сменную обувь. На входе в зал имеется место, где можно оставить уличную обувь.<br><br>Необходимо соблюдать чистоту в зале. Мусор и иные предметы, которые Вы принесли с собой, необходимо ЗАБРАТЬ после тренировки.<br><br>Во время занятий Администратор или куратор посещают зал для сверки списка забронировавших и фактически находящихся в помещении.<br><br>Зал необходимо покинуть за 5 минут до окончания забронированного времени, чтобы не задерживать следующих посетителей зала”",
         "В 11 корпусе поднимаемся на второй этаж, проходим в коридор справа от лифтов, идем по коридору до лифта, поднимаемся на 8 этаж, пространство будет справа",
         100, 'https://go.2gis.com/2Thge', 1),
        (2, "Sticker | Танцевальная база ДВФУ", "10", "8", "у лифта",
         "Для прохода в корпус необходимо:<br>- Прийти за 5 минут до начала своего времени.<br>- В случае, если Вы не проживаете в корпусе, оставить пропуск и записаться в журнале посещений на посту охраны (цель посещения – спортивный зал).<br><br>Для прохода в зал необходимо:<br>- Перед занятием обратиться к Администратору для получения ключей от зала, отметиться в журнале выдачи ключей о получении и забрать ключи.<br>- После окончания своего времени необходимо повторно отметиться в журнале выдачи ключей о сдаче и сдать ключ Администратору.<br><br>Обязательно приносить с собой сменную обувь. На входе в зал имеется место, где можно оставить уличную обувь.<br><br>Необходимо соблюдать чистоту в зале. Мусор и иные предметы, которые Вы принесли с собой, необходимо ЗАБРАТЬ после тренировки.<br><br>Во время занятий Администратор или куратор посещают зал для сверки списка забронировавших и фактически находящихся в помещении.<br><br>Зал необходимо покинуть за 5 минут до окончания забронированного времени, чтобы не задерживать следующих посетителей зала”",
         "В 11 корпусе поднимаемся на второй этаж, проходим в коридор справа от лифтов, идем по коридору до лифта, поднимаемся на 8 этаж, пространство будет справа",
         108, 'https://go.2gis.com/2Thge', 1),
        (3, "Euphoria | Танцевальная база ДВФУ", "9", "8", "у лифта",
         "Для прохода в корпус необходимо:<br>- Прийти за 5 минут до начала своего времени.<br>- В случае, если Вы не проживаете в корпусе, оставить пропуск и записаться в журнале посещений на посту охраны (цель посещения – спортивный зал).<br><br>Для прохода в зал необходимо:<br>- Перед занятием обратиться к Администратору для получения ключей от зала, отметиться в журнале выдачи ключей о получении и забрать ключи.<br>- После окончания своего времени необходимо повторно отметиться в журнале выдачи ключей о сдаче и сдать ключ Администратору.<br><br>Обязательно приносить с собой сменную обувь. На входе в зал имеется место, где можно оставить уличную обувь.<br><br>Необходимо соблюдать чистоту в зале. Мусор и иные предметы, которые Вы принесли с собой, необходимо ЗАБРАТЬ после тренировки.<br><br>Во время занятий Администратор или куратор посещают зал для сверки списка забронировавших и фактически находящихся в помещении.<br><br>Зал необходимо покинуть за 5 минут до окончания забронированного времени, чтобы не задерживать следующих посетителей зала”",
         "В 11 корпусе поднимаемся на второй этаж, проходим в коридор справа от лифтов, идем по коридору до лифта, поднимаемся на 8 этаж, пространство будет справа",
         92, 'https://go.2gis.com/cJLZZ', 1),
        (4, "Площадка ASAP.MUSIC под лестницей", "A", "4", "A411",
         "Пространство под лестницей, оборудованное всем необходимым для музыкального мероприятия.<br>На мероприятиях работают исключительно наши специалисты.<br>Закрыты на сессию, встретимся осенью",
         "Справа от лестницы",
         143, 'https://www.google.ru/?hl=ru', 2),
    ]

    space_images = [
        (1, "landscape.jpg", "Логотип InSpo", True),
        (1, "landscape.jpg", "Внутренний вид зала", False),
        (1, "logo.jpg", "Общий план", False),
        (2, "portrait.jpg", "Логотип Sticker", True),
        (2, "logo.jpg", "Внутренний вид", False),
        (3, "portrait.jpg", "Логотип Euphoria", True),
        (4, "logo.jpg", "Логотип ASAP", True),
    ]

    features = [
        (1, "projector"),
        (1, "mirror_wall"),
        (1, "sound_system"),
        (2, "mirror_wall"),
        (3, "projector"),
        (3, "whiteboard")
    ]

    with closing(db._get_connection()) as conn:
        try:
            conn.executemany(
                "INSERT INTO categories (id, name) VALUES (?, ?)",
                categories
            )

            conn.executemany(
                """INSERT INTO spaces 
                (id, name, building, level, location, description, location_description, likes, map_url, category_id)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)""",
                spaces
            )

            conn.executemany(
                "INSERT INTO space_images (space_id, image_url, alt_text, is_primary) VALUES (?, ?, ?, ?)",
                space_images
            )

            conn.executemany(
                "INSERT OR IGNORE INTO space_features (space_id, feature) VALUES (?, ?)",
                features
            )

            conn.commit()
            print("✅ Данные успешно загружены в БД:")
            print(f"- {len(categories)} категорий")
            print(f"- {len(spaces)} пространств")
            print(f"- {len(space_images)} изображений")
            print(f"- {len(features)} характеристик")

        except sqlite3.Error as e:
            print(f"❌ Ошибка при загрузке данных: {e}")
            conn.rollback()
            raise


if __name__ == "__main__":
    init_sample_data()